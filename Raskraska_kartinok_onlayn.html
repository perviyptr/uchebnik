<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-117113579-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-117113579-1');
</script>

	<title>Раскраска картинок онлайн</title>

  <link rel="stylesheet" type="text/css" href="style.css">

	<style type="text/css">

body{
  background-image: url('Ris12/Фон.JPG');
}

canvas{
  border: 1px solid #000;
  cursor: pointer;
  background-image: url('Ris12/Фон3.JPG');
}

.paneli {
   width: 500px;
   text-align: center;
   color: rgb(99, 5, 99);
   background-color: rgb(247, 215, 247);
   display: flex;
   flex-direction:row;
   justify-content: space-around;
   align-items: center;
}

.paneli2 {
   width: 500px;
   border: dotted 1px;
   text-align: center;
   color: rgb(99, 5, 99);
   background-color: rgb(247, 215, 247);
   display: flex;
   flex-direction:row;
   justify-content: space-around;
   align-items: center;
}

.dla_odnogo_instrumenta{
  width: 30%;
}

.cvet, .paneli2 .panel-button {
  width: 35px;
  height: 35px;
  margin: 3px;
  margin-bottom: 7px;
  border: 2px groove rgb(250, 7, 222);
  box-shadow: 0 5px 5px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
  cursor: pointer;
}

.cvet:hover, .paneli2 .panel-button:hover {
  border: solid 2px rgb(255,255,255);
  background: white;
}

.obchaja_ramka{
  width: 1200px;
  display: flex;
  flex-direction:row;
  justify-content: center;
  align-items: flex-start;
  margin: auto;
}

.dla_risunkov{
  width:450px;
  height: 850px;
  display: flex;
  flex-direction:column;
  justify-content: space-around;
  align-items: flex-start;
  flex-wrap:wrap;
  align-content:space-around;
  border: dotted 1px;
}

#dla_canvasa_i_paneley{
  width: 500px;
  display: flex;
  flex-direction:column;
  justify-content: center;
  align-items: center;
  box-shadow: 0 28px 56px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
  background-color: rgb(255,255,255);
}

.kartinki {
   width: 100px;
   height: 100px;
   cursor: pointer;
   margin: 30px 30px;
}

.kartinki:hover{
  background-color: rgb(222, 202, 237);
  box-shadow: 0 5px 5px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
}
#zagolovok{
  color: rgb(237, 33, 186);
  text-shadow: 0 5px 5px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
}
.nadpisi_k_panelam{
  font-size: 14pt;
  color: rgb(77, 3, 58);
  margin: 5px;
}

a{
  text-decoration: none;
  color: rgb(77, 3, 58);
}
a:hover{
  color: rgb(245, 61, 199);
}
#nadpis_pod_zagolovkom{
  color: rgb(77, 3, 58);
  margin-top: 0;
}
i{
   color: rgb(212, 8, 161);
}

.panel-button-current {
  outline: 5px solid red;
}
#nizniy_dla_kartinok{
  width: 1200px;
  display: flex;
  flex-direction:row;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap:wrap;
  align-content:space-around;
  border: dotted 1px;
  margin: 0 auto;
}

  </style>
</head>



<body>

<iframe class ="menu" src="menu.html"></iframe>

<div class="obchaja_ramka">

<div class="dla_risunkov">
  <img class = "kartinki" src="Ris12/1.png">
  <img class = "kartinki" src="Ris12/2.png">
  <img class = "kartinki" src="Ris12/3.png">
  <img class = "kartinki" src="Ris12/4.png">
  <img class = "kartinki" src="Ris12/5.png">
  <img class = "kartinki" src="Ris12/6.png">
  <img class = "kartinki" src="Ris12/7.png">
  <img class = "kartinki" src="Ris12/8.png">
  <img class = "kartinki" src="Ris12/9.png">
  <img class = "kartinki" src="Ris12/10.png">
</div>

<div id="dla_canvasa_i_paneley">

  <h1 id="zagolovok">РАСКРАСКА КАРТИНОК</h1>
  <ul id="nadpis_pod_zagolovkom">
    <li>Выбирайте любую картинку на фоне страницы левой кнопкой мыши и раскрашивайте.</li>
    <li>Можно нарисовать свой рисунок или добавить своё изображение<br> к вставленному.<br>
    Для этого включите режим <i>Рисование линий</i>.</li>
    <li>Для сохранения картинки щёлкните правой кнопкой мыши на холсте и выберите
      <i>Сохраниь картинку как</i>...</li>
  </ul>
<div class="paneli2 panel">
  <div class="dla_odnogo_instrumenta">
    <p class="nadpisi_k_panelam">Линия</p>
    <img class="panel-button" data-mode="paint" src="Ris12/linija.JPG">
   </div>
   <div class="dla_odnogo_instrumenta">
    <p class="nadpisi_k_panelam">Заливка</p>
    <img class="panel-button panel-button-current" data-mode="fill" src="Ris12/cherniy_karandash.JPG">
    </div>
   <div class="dla_odnogo_instrumenta">
    <p class="nadpisi_k_panelam">Ластик</p>
    <img class="panel-button" id="lastik" data-mode="lastik" src="Ris12/lastik.JPG">
   </div>
</div>

<div class="paneli panel">
  <img class="cvet panel-button panel-button-current" src="Ris12/cherniy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/seriy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/krasniy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/oranjeviy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/jeltiy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/zeleniy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/goluboy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/siniy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/fioletoviy_karandash.JPG">
  <img class="cvet panel-button" src="Ris12/beliy_karandash.JPG">
</div>


<canvas id="canvas" width="500" height="500"></canvas>

<div class="paneli">
     <p id="ochistit" class="nadpisi_k_panelam"><a href="#clear">Очистить</a></p>
</div>
</div>

<div class="dla_risunkov">
    <img class = "kartinki" src="Ris12/11.png">
    <img class = "kartinki" src="Ris12/12.png">
    <img class = "kartinki" src="Ris12/13.png">
    <img class = "kartinki" src="Ris12/14.png">
    <img class = "kartinki" src="Ris12/15.png">
    <img class = "kartinki" src="Ris12/16.png">
    <img class = "kartinki" src="Ris12/17.png">
    <img class = "kartinki" src="Ris12/18.png">
    <img class = "kartinki" src="Ris12/19.png">
    <img class = "kartinki" src="Ris12/20.png">

</div>

</div>

<div id="nizniy_dla_kartinok">
    <img class = "kartinki" src="Ris12/21.png">
    <img class = "kartinki" src="Ris12/22.png">
    <img class = "kartinki" src="Ris12/23.png">
    <img class = "kartinki" src="Ris12/24.png">
    <img class = "kartinki" src="Ris12/25.png">
    <img class = "kartinki" src="Ris12/26.png">
    <img class = "kartinki" src="Ris12/27.png">
    <img class = "kartinki" src="Ris12/28.png">
    <img class = "kartinki" src="Ris12/29.png">
    <img class = "kartinki" src="Ris12/30.png">
    <img class = "kartinki" src="Ris12/31.png">
    <img class = "kartinki" src="Ris12/32.png">
    <img class = "kartinki" src="Ris12/33.png">
    <img class = "kartinki" src="Ris12/34.png">
</div>

<h3>Большое спасибо сайту <a href="http://moi-raskraski.ru/">moi-raskraski.ru</a> за картинки.
</h3>


<script type="text/javascript">

var mouseDown = false;
var currentMode = 'fill';
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
ctx.lineJoin = 'round';
ctx.lineWidth = 3;
var lastPoint = {x: 0, y: 0};
var cvet = document.getElementsByClassName('cvet');
var colors = [[0,0,0], [192,192,192], [255,0,0], [255,128,0], [255,255,0], [0,255,0], [128,255,255], [0,0,255], [255,128,255], [255,255,255]];
var massiv_cvetov = colors.map(color => rgbToHex.apply(null, color));
var massiv_cvetov2 = colors.map(color => 'rgb(' + color.join(',') + ')');
var cvet_zalivki = massiv_cvetov[0];
let currentColor = massiv_cvetov2[0];

function rgbToHex(r, g, b) {
  return (0xFF000000 | (b << 16) | (g << 8) | r) >>> 0;
}

for (let i = 0; i < cvet.length; i++) {
  cvet[i].addEventListener('click', function VibratCvet(event) {
    event.preventDefault();
    highlightCurrent(cvet[i]);

    cvet_zalivki = massiv_cvetov[i];
    currentColor =  massiv_cvetov2[i];

    if (currentMode !== 'lastik') {
      ctx.strokeStyle = currentColor;
    }
  });
}

canvas.addEventListener('mousedown', function (event) {
  if (event.which !== 1) {
    return;
  }

  event.preventDefault();

  if (currentMode === 'paint' || currentMode === 'lastik') {
    mouseDown = true;
    ctx.beginPath();
    lastPoint.x = event.offsetX;
    lastPoint.y = event.offsetY;
  }
  else
    floodFill(event.offsetX, event.offsetY, cvet_zalivki);
});


canvas.addEventListener('mousemove', function (event) {
  if (!mouseDown) {
    return;
  }

  ctx.lineTo(event.offsetX, event.offsetY);
  ctx.stroke();
  lastPoint.x = event.offsetX;
  lastPoint.y = event.offsetY;
});

canvas.addEventListener('mouseup', function (event) {
  mouseDown = false;
});

  var ochistit = document.getElementById('ochistit');
  ochistit.addEventListener("click", Oscistit_holst);
  function Oscistit_holst(){
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

for (const link of document.querySelectorAll('.paneli2 .panel-button')) {
  link.addEventListener('click', function (event) {
    event.preventDefault();

    var mode = link.dataset.mode;
    highlightCurrent(link);

    switch (mode) {
      case "fill":
        currentMode = 'fill';
        break;
      case "paint":
        currentMode = 'paint';
        ctx.lineWidth = 3;
        ctx.strokeStyle = currentColor;
        break;
      case "lastik":
        currentMode = 'lastik';
        ctx.lineWidth = 30;
        ctx.strokeStyle = 'white';
        break;
    }
  });
}

function highlightCurrent(element) {
  for (const button of element.closest('.panel').getElementsByClassName('panel-button')) {
    button.classList.remove('panel-button-current');
  }

  element.classList.add('panel-button-current');
}


const outlineImage = new Image();

outlineImage.onload = function () {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(outlineImage, 0, 0, canvas.width, canvas.height);

  try {
    outlineLayerData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  } catch (ex) {
    window.alert("Приложение не может выполняться локально. Запустите на сервере.");
    return;
  }
  colorLayerData = ctx.getImageData(0, 0, canvas.width, canvas.height);
};


var kartinki = document.getElementsByClassName('kartinki');

for(let i = 0; i < kartinki.length; ++i){
  kartinki[i].addEventListener('click', function Vibor_kartinki(){
    outlineImage.src = 'Ris12/' + (i + 1) + '.png';
  });
}


function floodFill(x, y, color){
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const imageArray = new Uint32Array(imageData.data.buffer);
  const width = imageData.width;
  const height = imageData.height;
  const stack = [[x, y]];
  const sourceColor = imageArray[y * width + x];

  if (sourceColor === color) {
    // Иначе будет заливать бесконечно
    return;
  }

  while (stack.length > 0) {
   const  pixel = stack.pop();
    if (pixel[0] < 0 || pixel[0] >= width)
      continue;
    if (pixel[1] < 0 || pixel[1] >= height)
      continue;

    const point = pixel[1] * width + pixel[0];

    // Если не совпадает с исходным цветом
    if (imageArray[point] !== sourceColor) {
      continue;
    }

    // Закрашиваем
    imageArray[point] = color;

    // Ставим соседей в стек на проверку
    stack.push([
      pixel[0] - 1,
      pixel[1]
    ]);
    stack.push([
      pixel[0] + 1,
      pixel[1]
    ]);
    stack.push([
      pixel[0],
      pixel[1] - 1
    ]);
    stack.push([
      pixel[0],
      pixel[1] + 1
    ]);
  }
  ctx.putImageData(imageData, 0, 0);
}

</script>

</body>

</html>






